name: Osibusi Biraz IPTV Otomatik

on:
  schedule:
    - cron: "0 */3 * * *" # Her 3 saatte bir
  workflow_dispatch:

jobs:
  run-osibusi:
    runs-on: ubuntu-latest
    steps:
      - name: 📦 Repo'yu Klonla
        uses: actions/checkout@v4

      - name: 🐍 Python Kur
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: 📦 Bağımlılıkları Kur
        run: |
          pip install requests httpx

      - name: ▶️ OSIBUSI Script Çalıştır
        run: |
          echo "🚀 biraz.py çalıştırılıyor..."
          python biraz.py
          echo "✅ Script tamamlandı."
          ls -R M3U || echo "⚠️ M3U klasörü boş olabilir."

      - name: 💾 Değişiklikleri Git'e Ekle ve Push Et
        shell: bash
        run: |
          echo "🔧 Git yapılandırması yapılıyor..."
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

          echo "💾 Değişiklikler hazırlanıyor..."
          if [ -f M3U/Osibusibiraz.m3u ]; then
            echo "📂 Dosya bulundu: M3U/Osibusibiraz.m3u"
            git add M3U/Osibusibiraz.m3u
          else
            echo "⚠️ Osibusibiraz.m3u bulunamadı, tüm .m3u dosyaları ekleniyor..."
            git add M3U/*.m3u || true
          fi

          echo "🧩 Pull & Rebase yapılıyor..."
          git stash || true
          git pull --rebase origin main || echo "Pull başarısız, devam ediliyor."
          git stash pop || true

          echo "🪶 Commit işlemi..."
          git commit -m 'Otomatik güncelleme: '"$(date '+%Y-%m-%d %H:%M:%S')" || echo "ℹ️ Değişiklik yok"

          echo "🚀 Push işlemi..."
          git push origin main || echo "⚠️ Push sırasında hata olabilir, kontrol et."
